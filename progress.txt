# Ralph Progress Log
Started: Wed Feb 18 04:31:00 HST 2026
---

## US-001 — Home screen is the Dialectics landing state with prompt bubbles
Status: PASS
Date: 2026-02-18

Implementation:
- Replaced HomeView dashboard with a Dialectics-first layout: prompt bubbles at top, compact recent items below, CaptureBarView inline with the Recent header
- Added PromptBubble model and PromptBubbleView component with hover state, label badge, prompt text, and arrow icon
- Heuristic bubble generator builds 2-3 bubbles based on: stale high-value items (30+ days), recent tag clusters (7-day window), contradiction connections; falls back to "Start a conversation" when knowledge base is empty
- Added groveStartConversationWithPrompt notification; tapping a bubble fires it with the prompt string
- ContentViewNotificationHandlers handles the notification: creates a new Conversation, immediately sends the prompt as the first user message via DialecticsService.sendMessage, then opens the chat panel
- Moved Suggestion/SuggestionType models to Views/Components/SuggestionModel.swift (was defined inline in HomeView but also used by BoardDetailView)
- Build passes with zero errors

## US-002 — Conversation starter generation service
Status: PASS
Date: 2026-02-18

Implementation:
- Created ConversationStarterService (grove/Sources/Services/ConversationStarterService.swift)
- @MainActor @Observable class with ConversationStarterServiceProtocol (also @MainActor to satisfy Swift 6 Sendable rules)
- Single LLM call via LLMServiceConfig.makeProvider().complete(system:user:service:) returning JSON array [{prompt, label}]
- Heuristic fallback: staleness revisit, recent-tag cluster, contradiction resolver — same logic as US-001 but now encapsulated in the service
- In-memory caching via hasLoaded flag — refresh() is a no-op after first call per app launch
- Failure-tolerant: LLM errors fall through to heuristics; empty KB shows no bubbles (fallback "Start a conversation" in UI)
- PromptBubble model moved from HomeView.swift to SuggestionModel.swift so both the service and UI can reference it
- HomeView updated: @State private var starterService = ConversationStarterService(); .task calls await starterService.refresh(items:)
- Removed inline buildHeuristicBubbles() from HomeView
- Build passes with zero errors

## US-003 — Auto-board suggestion on capture
Status: PASS
Date: 2026-02-18

Implementation:
- AutoTagService modified: when LLM suggests a board that doesn't match any existing board, instead of auto-creating it, stores "pendingBoardSuggestion" in item.metadata and posts Notification.Name.groveNewBoardSuggestion with {itemID, boardName, isColdStart}
- Existing-board assignment path unchanged: high-confidence matches still auto-assign directly
- CaptureBarView updated: listens for groveNewBoardSuggestion via onReceive; shows BoardSuggestionBanner inline below the capture field with "Create" and dismiss (×) buttons; auto-dismisses after 5 seconds via Task.sleep; skip suggestion if a board is already selected (currentBoardID != nil)
- BoardSuggestionBanner: monochromatic, uses bgCard + textSecondary + groveBodySmall; transitions in with .opacity + .move(edge: .top)
- CaptureBarOverlayView: same banner added; overlay stays open while suggestion is visible, then dismisses with suggestion
- ItemViewModel.autoTagItem: when LLM is not configured but zero boards exist (cold start), derives a heuristic board name from item title (first 3 words, title-cased), posts groveNewBoardSuggestion; tracks count in UserDefaults "grove.coldStartCaptureCount" — only fires on first 3 captures
- Notification extension defined in AutoTagService.swift; no new files created
- Build passes with zero errors

## US-004 — Unboarded items surfaced as conversation starter
Status: PASS
Date: 2026-02-18

Implementation:
- ConversationStarterService: added findUnboardedCluster() heuristic — finds unboarded items (no board, status active/inbox) sharing a tag, requires ≥4 items and ≥2 distinct shared tags for quality; returns the largest cluster keyed on the most-shared tag
- StarterContext extended with unboardedCluster: UnboardedCluster? (struct with sharedTag, items, count)
- Heuristic buildHeuristics() adds an ORGANIZE-label PromptBubble for the cluster when didShowClusterBubble is false (once per launch gate)
- LLM path: cluster info appended to user message with "ORGANIZE" label hint; didShowClusterBubble set to true so the flag is consistent with heuristic path
- PromptBubble model extended with clusterTag: String? and clusterItemIDs: [UUID] (default nil/empty); backward-compatible via memberwise init default parameters
- KnowledgeBaseTools: added create_board tool — creates a Board entity, assigns items by title match, persists via modelContext.save(); duplicate board names are rejected; added to toolDescriptions static (DialecticsService system prompt automatically embeds it)
- HomeView: openConversation() now accepts seedItemIDs: [UUID]; ORGANIZE bubbles pass bubble.clusterItemIDs; notification userInfo["seedItemIDs"] carries the IDs
- ContentView: groveStartConversationWithPrompt handler reads seedItemIDs from userInfo; startConversation(withPrompt:seedItemIDs:) fetches matching Item entities and seeds the conversation context via DialecticsService.startConversation(seedItems:)
- Build passes with zero errors

## US-005 — Full-text search bar in Library view
Status: PASS
Date: 2026-02-18

Implementation:
- Added `.library` case to `SidebarItem` enum in ContentView.swift
- Added "Library" entry in SidebarView (below Home, in the same section)
- Created grove/Sources/Views/Library/LibraryView.swift — new primary Library view
- LibraryView features:
  - Persistent search bar at top (always visible, never hidden behind a button)
  - @Query fetches all items sorted by updatedAt descending (reverse-chronological default)
  - Debounced search (~300ms) via Task.sleep + cancellable searchTask
  - Search covers: item title, content, tag names, and ReflectionBlock content (fetched from SwiftData)
  - Board filter chips below search bar — "All" chip resets filter; board chips narrow scope; chips use design tokens (bgTagActive / borderTag)
  - List rows show: type icon, title, board + tags (first 2), relative date, growth stage indicator, connection count, reflection count
  - Empty state for both zero items and zero search results
  - selectedItemStyle / double-tap-to-open patterns match BoardDetailView
- ContentView.detailContent wires .library to LibraryView(selectedItem:openedItem:)
- Ran tuist generate --no-open after adding new file
- Build passes with zero errors
