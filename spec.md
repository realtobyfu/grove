# Grove — Project Specification

## Overview

**Grove** is a Mac-native knowledge companion for technical learners. It captures articles, videos, and ideas, organizes them into boards with auto-tagging, and actively nudges users to engage with their saved knowledge.

**One-liner:** A Mac-native knowledge companion that captures, organizes, and *activates* your reading and learning queue.

**Target users:** Software engineers, AI/ML practitioners, technical learners, and intellectually curious people who consume a lot of articles, videos, and course material but struggle to synthesize and revisit it.

**Platform:** macOS (native SwiftUI app). Minimum deployment target: macOS 15 (Sequoia).

**Tech stack:** Swift, SwiftUI, SwiftData, swift-markdown, TextKit 2, Core Animation.

---

## Architecture

### Data Model

#### Item
The atomic unit. Everything captured is an Item.

```swift
@Model
class Item {
    var id: UUID
    var type: ItemType               // .article, .video, .note, .courseLecture
    var title: String
    var sourceURL: String?
    var content: String?             // markdown body for notes, excerpt for articles
    var thumbnail: Data?
    var createdAt: Date
    var updatedAt: Date
    var status: ItemStatus           // .inbox, .active, .archived, .dismissed
    var engagementScore: Float       // computed: rises with opens, annotations, links
    var metadata: [String: String]   // flexible per-type (video duration, author, etc.)

    var boards: [Board]
    var tags: [Tag]
    var annotations: [Annotation]
    var outgoingConnections: [Connection]
    var incomingConnections: [Connection]
}

enum ItemType: String, Codable {
    case article
    case video
    case note
    case courseLecture
}

enum ItemStatus: String, Codable {
    case inbox
    case active
    case archived
    case dismissed
}
```

#### Board
A domain/context container.

```swift
@Model
class Board {
    var id: UUID
    var title: String
    var boardDescription: String?
    var icon: String?                // SF Symbol name
    var color: String?               // hex color string
    var createdAt: Date
    var sortOrder: Int
    var isSmart: Bool                // smart boards = auto-populated by tag rules
    var smartRuleTags: [Tag]?        // tags that auto-populate this board

    var items: [Item]
    var pinnedTags: [Tag]            // tags used for grouping within the board
}
```

#### Tag
The connective tissue.

```swift
@Model
class Tag {
    var id: UUID
    var name: String
    var isAutoGenerated: Bool
    var confidence: Float?           // for auto-tags, AI confidence score
    var category: TagCategory        // .topic, .concept, .technology, .person, .custom

    var items: [Item]
}

enum TagCategory: String, Codable {
    case topic
    case concept
    case technology
    case person
    case custom
}
```

#### Connection
Item-to-item relationships that form the knowledge graph.

```swift
@Model
class Connection {
    var id: UUID
    var sourceItem: Item
    var targetItem: Item
    var type: ConnectionType         // .related, .contradicts, .buildsOn, .inspiredBy, .sameTopic
    var note: String?                // "this takes the opposite view on X"
    var isAutoGenerated: Bool
    var createdAt: Date
}

enum ConnectionType: String, Codable {
    case related
    case contradicts
    case buildsOn
    case inspiredBy
    case sameTopic
}
```

#### Annotation
Notes on items.

```swift
@Model
class Annotation {
    var id: UUID
    var item: Item
    var content: String              // markdown
    var highlight: String?           // the passage being responded to
    var position: Int?               // paragraph or timestamp index
    var createdAt: Date
}
```

#### Nudge
Powers the proactive layer.

```swift
@Model
class Nudge {
    var id: UUID
    var type: NudgeType              // .resurface, .connectionPrompt, .staleInbox, .streak
    var targetItem: Item?
    var relatedItemIDs: [UUID]?
    var message: String
    var createdAt: Date
    var status: NudgeStatus          // .pending, .shown, .actedOn, .dismissed
    var scheduledFor: Date
}

enum NudgeType: String, Codable {
    case resurface
    case connectionPrompt
    case staleInbox
    case streak
}

enum NudgeStatus: String, Codable {
    case pending
    case shown
    case actedOn
    case dismissed
}
```

---

## UI/UX Architecture

### Layout
Three-column NavigationSplitView (standard macOS pattern).

```
┌──────────┬────────────────────────┬──────────────────┐
│ Sidebar  │     Main Content       │  Inspector       │
│          │                        │  (collapsible)   │
│ ○ Inbox  │  Adapts per context:   │                  │
│          │  - Board grid/list     │  Item detail     │
│ Boards   │  - Inbox triage        │  Tags            │
│ ▸ Swift  │  - Graph view          │  Connections     │
│ ▸ Dist.  │                        │  Annotations     │
│ ▸ Phil.  │                        │                  │
│          │                        │                  │
│ Tags     │                        │                  │
│ Graph    │                        │                  │
└──────────┴────────────────────────┴──────────────────┘
```

### View Hierarchy

```
GroveApp
├── MenuBarCapture (floating window, ⌘+Shift+K)
│
├── MainWindow (NavigationSplitView)
│   ├── SidebarView
│   │   ├── InboxRow (with badge count)
│   │   ├── BoardListSection
│   │   │   └── BoardRow (icon, color dot, title, item count)
│   │   ├── TagBrowserRow
│   │   └── GraphViewRow
│   │
│   ├── ContentView (center column, adapts to selection)
│   │   ├── InboxTriageView
│   │   │   └── InboxCard (title, source, auto-tags, suggested board, keep/later/drop)
│   │   ├── BoardDetailView
│   │   │   ├── BoardHeader (title, description, filter bar)
│   │   │   ├── ViewToggle (grid / list)
│   │   │   ├── TagClusterSection (auto-grouped by tag overlap)
│   │   │   │   └── ItemCard (type icon, title, connection count, annotation count)
│   │   │   └── NudgeBar (top, dismissable, one at a time)
│   │   ├── ItemReaderView
│   │   │   ├── ArticleContent / EmbeddedWebView
│   │   │   ├── InlineAnnotationOverlay
│   │   │   └── AnnotationList
│   │   └── GraphVisualizationView (v1.5)
│   │
│   └── InspectorView (right column, collapsible)
│       ├── ItemMetadataSection (title, source, type, dates)
│       ├── TagSection (with add/remove, shows confidence for auto-tags)
│       ├── BoardMembershipSection
│       ├── ConnectionsSection (linked items with type labels)
│       └── EngagementSection (score visualization)
│
├── SettingsWindow
│   ├── GeneralSettings
│   ├── CaptureSettings (keyboard shortcut, default board)
│   ├── NudgeSettings (frequency, types enabled)
│   └── AISettings (auto-tag confidence threshold, model config)
│
└── SafariExtension / ChromeExtension (share to Grove inbox)
```

---

## Feature Specification

### V1 — Foundation (MVP)

**Goal:** A useful, polished Mac app that captures, organizes, and resurfaces knowledge. Ship to App Store.

#### F1: Quick Capture
- Global keyboard shortcut (⌘+Shift+K) opens a floating capture window from anywhere on macOS
- Paste a URL → app auto-fetches title, description, thumbnail, and detected content type
- Type raw text → creates a note item
- All captures land in Inbox with status `.inbox`
- Capture window dismisses on submit, under 2 seconds total interaction
- Safari/Chrome share extension sends URLs to inbox

#### F2: Inbox Triage
- Dedicated inbox view showing all `.inbox` items in a card stack
- Each card shows: title, source, auto-generated tags, suggested board
- Three actions per card: **Keep** (→ `.active`, assign to board), **Later** (stays in inbox, resets timer), **Drop** (→ `.dismissed`)
- Keyboard navigation: `J/K` to move between cards, `1/2/3` for actions
- Items untouched in inbox for 30+ days get auto-dimmed with a "still interested?" prompt
- Batch triage mode: select multiple, assign to board at once

#### F3: Boards
- User-created boards with custom title, SF Symbol icon, and color accent
- Drag-and-drop items between boards (items can belong to multiple boards)
- Board view shows items as cards in a grid (default) or list (toggle)
- Items within a board are auto-grouped by tag clusters (shared tags → same group)
- Cluster section headers are auto-generated labels (e.g., "concurrency & async/await")
- Users can pin, rename, collapse, or reorder cluster sections
- Filter bar at top of board: filter by tag, type, status, date range
- Sort options: date added, engagement score, title, last opened

#### F4: Auto-Tagging
- On capture, run content through local LLM or API to generate tags
- Tags assigned with category (.topic, .concept, .technology, .person) and confidence score
- Auto-tags shown with subtle visual distinction (dimmed, dashed border)
- User can confirm (promotes to full tag), edit, or dismiss auto-tags
- Tag confidence threshold configurable in settings (default: 0.6)
- Tag suggestions appear when manually tagging (fuzzy search existing tags)

#### F5: Inspector Panel
- Right column showing detail for selected item
- Sections: metadata, tags, board membership, connections, engagement score
- Inline editing for all fields
- Connection section shows linked items with relationship type labels
- "Add connection" action opens fuzzy search to find and link another item
- Collapsible via toolbar button or keyboard shortcut

#### F6: Annotations & Notes
- Select text in article content → annotation popover appears
- Annotations support markdown with `[[wiki-link]]` syntax
- Typing `[[` opens fuzzy search dropdown of all items; selecting one auto-creates a Connection
- Annotations are listed below article content and in the inspector
- Standalone note items use the same markdown editor
- Markdown rendering via swift-markdown parser + TextKit 2
- Support for: headings, bold/italic, code blocks (with syntax highlighting), LaTeX (basic), links, `[[wiki-links]]`

#### F7: Nudge System (Basic)
- Nudge bar at top of main content area, one nudge at a time, dismissable
- V1 nudge types:
  - **Resurface:** "You saved [item] X days ago and haven't opened it. Still interested?"
  - **Stale inbox:** "You have X items in inbox older than 2 weeks. Time to triage?"
- Nudges generated on app launch and periodically (configurable frequency)
- Nudge status tracked: shown, acted on, dismissed
- Dismissed nudge types for specific items don't recur

#### F8: Search
- Global search (⌘+F) across all items, annotations, tags, and boards
- Fuzzy matching on titles, content, tag names
- Results grouped by type (items, annotations, boards, tags)
- Search from within a board scopes to that board's items

#### F9: Keyboard-First Design
- Full keyboard navigation throughout the app
- Key shortcuts:
  - `⌘+Shift+K` — Quick capture
  - `⌘+N` — New note
  - `⌘+F` — Search
  - `⌘+1/2/3...` — Switch boards
  - `J/K` — Navigate items
  - `Enter` — Open selected item
  - `⌘+T` — Add tag to selected item
  - `⌘+L` — Add connection (`[[` link)
  - `⌘+]` / `⌘+[` — Toggle inspector

---

### V1.5 — Intelligence Layer

**Goal:** Make the app smarter. Auto-connections, smart boards, graph visualization.

#### F10: Connection Suggestions
- After capturing or annotating an item, the AI suggests connections to existing items
- Suggestions shown as a non-intrusive prompt: "This might relate to [item]. Connect?"
- Connection type auto-inferred (builds_on, contradicts, related, etc.)
- User confirms or dismisses; feedback improves future suggestions

#### F11: Smart Boards
- Boards with `isSmart: true` auto-populate based on tag rules
- Example: a smart board "Concurrency" includes any item tagged #concurrency, #async, #parallelism
- Smart board rules editable via a simple tag-based query builder
- Items appear/disappear as tags are added/removed

#### F12: Graph Visualization
- Full-screen or panel view showing items as nodes, connections as edges
- Force-directed layout using SpriteKit or Core Animation
- Nodes colored by board membership, sized by engagement score
- Edges styled by connection type (solid for builds_on, dashed for related, red for contradicts)
- Filter graph by board, tag, date range
- Click a node to select it and show detail in inspector
- Zoom, pan, and cluster controls

#### F13: Advanced Nudges
- **Connection prompts:** "You added 3 articles on [topic] this week. Want to write a synthesis note?"
- **Streak nudges:** "You've engaged with your Swift board 5 days in a row."
- Nudge frequency and types configurable per-board
- Nudge analytics: track which nudge types drive engagement

#### F14: Tag Clustering & Auto-Grouping Improvements
- Smarter tag cluster detection using semantic similarity (not just exact tag overlap)
- Suggested merges for similar tags (e.g., "async-await" and "async/await")
- Tag hierarchy suggestions (e.g., "Swift" parent of "SwiftUI", "Concurrency")

---

### V2 — Learning Engine

**Goal:** Transform Grove from a knowledge organizer into an active learning tool.

#### F15: Course Tracking
- First-class support for course/lecture series (MIT OCW, Stanford, PointFree, etc.)
- Define a course: title, source URL, list of lectures in order
- Course view shows progress (lectures completed, current position)
- Lectures are Items with type `.courseLecture` and sequence metadata
- "Continue course" action in nudge system: "Lecture 5 of MIT 6.824 is next. It covers fault tolerance — you have 2 saved articles on that topic."
- Ability to link supplementary articles/notes to specific lectures

#### F16: AI Synthesis Notes
- "Generate summary" action on a board or tag cluster
- AI reads all items + annotations in scope and generates a draft synthesis note
- Draft appears as a new note Item, editable by the user
- Synthesis notes highlight: key themes, contradictions between sources, open questions
- Explicitly marked as AI-generated with human edit history

#### F17: Spaced Resurfacing
- Items you've annotated or connected enter a spaced repetition-like resurfacing queue
- Not flashcard-style — more like "here's something you found important 3 weeks ago, revisit it"
- Resurfacing frequency adapts based on engagement: items you keep engaging with resurface less frequently (you already know them), items you engaged with once resurface more
- Optional: quiz-like prompts ("What was the key insight from [article]?")

#### F18: Export & Sharing
- Export a board as: markdown document, PDF, OPML (for RSS readers)
- Share a board as a public read-only web page (curated reading list)
- Export individual items with annotations as markdown
- "Send to Obsidian" / "Send to Ulysses" integration (export as .md files to a configured folder)

#### F19: Local Video Support
- Import local video files (downloaded lectures, conference talks)
- Basic playback within Grove (AVKit)
- Timestamp-linked annotations (annotate at 12:34 in the video)
- Auto-chapter detection from video metadata or AI analysis

#### F20: Multi-Device Sync
- CloudKit-based sync for items, boards, tags, connections, annotations
- Conflict resolution strategy: last-write-wins for simple fields, merge for tags/connections
- Future consideration: iOS companion app (read-only or lightweight capture)

---

## Non-Functional Requirements

### Performance
- App launch to usable: under 1 second
- Quick capture window appears: under 200ms
- Search results: under 100ms for up to 10,000 items
- Smooth 60fps scrolling in board grid view

### Design Principles
- **Mac-native:** NavigationSplitView, `.sidebar` material, SF Symbols, system font, vibrancy. It should look like Apple made it.
- **Dark mode first:** Engineers live in dark mode. Light mode is supported but dark mode is the default development target.
- **Keyboard-first:** Every action reachable via keyboard. Mouse/trackpad is secondary.
- **Zero-friction capture:** If saving something takes more than 3 seconds, the system has failed.
- **Progressive engagement:** An item with no annotations or connections is a bookmark. One with 5 connections and notes is knowledge. The UI should make this progression visible and rewarding.

### Privacy & Data
- All data stored locally by default (SwiftData + local SQLite)
- AI features (auto-tagging, synthesis) can use local models (Core ML) or optional API calls
- No telemetry, no analytics, no tracking
- User owns all their data; export everything at any time

---

## Project Structure

```
Grove/
├── GroveApp.swift                      # App entry point, scene configuration
├── Models/
│   ├── Item.swift
│   ├── Board.swift
│   ├── Tag.swift
│   ├── Connection.swift
│   ├── Annotation.swift
│   └── Nudge.swift
├── Views/
│   ├── Sidebar/
│   │   ├── SidebarView.swift
│   │   ├── InboxRow.swift
│   │   └── BoardRow.swift
│   ├── Inbox/
│   │   ├── InboxTriageView.swift
│   │   └── InboxCard.swift
│   ├── Board/
│   │   ├── BoardDetailView.swift
│   │   ├── ItemCardView.swift
│   │   ├── TagClusterSection.swift
│   │   └── BoardFilterBar.swift
│   ├── Item/
│   │   ├── ItemReaderView.swift
│   │   ├── AnnotationOverlay.swift
│   │   └── AnnotationListView.swift
│   ├── Inspector/
│   │   ├── InspectorView.swift
│   │   ├── TagSection.swift
│   │   ├── ConnectionSection.swift
│   │   └── EngagementSection.swift
│   ├── Graph/
│   │   └── GraphVisualizationView.swift    # v1.5
│   ├── Capture/
│   │   └── QuickCaptureWindow.swift
│   ├── Search/
│   │   └── SearchView.swift
│   ├── Nudge/
│   │   └── NudgeBarView.swift
│   └── Settings/
│       └── SettingsView.swift
├── ViewModels/
│   ├── InboxViewModel.swift
│   ├── BoardViewModel.swift
│   ├── ItemViewModel.swift
│   ├── SearchViewModel.swift
│   └── NudgeViewModel.swift
├── Services/
│   ├── CaptureService.swift                # URL metadata fetching, content extraction
│   ├── AutoTagService.swift                # AI tagging pipeline
│   ├── NudgeEngine.swift                   # Nudge generation logic
│   ├── ConnectionSuggestionService.swift   # v1.5
│   ├── SynthesisService.swift              # v2
│   └── URLMetadataFetcher.swift            # OpenGraph / meta tag extraction
├── Markdown/
│   ├── GroveMarkdownParser.swift           # swift-markdown based, supports [[wiki-links]]
│   ├── GroveTextView.swift                 # TextKit 2 based markdown editor
│   └── WikiLinkResolver.swift              # Resolves [[links]] to Item references
├── Extensions/
│   ├── Date+Extensions.swift
│   ├── String+Extensions.swift
│   └── Color+Extensions.swift
├── Resources/
│   └── Assets.xcassets
├── Safari Extension/                       # Share to Grove
│   └── ...
└── Tests/
    ├── ModelTests/
    ├── ViewModelTests/
    └── ServiceTests/
```

---

## V1 Build Order

Recommended implementation sequence:

1. **Data model** — Define all SwiftData models, relationships, and enums
2. **App shell** — NavigationSplitView with sidebar, empty content area, empty inspector
3. **Board CRUD** — Create, edit, delete boards; sidebar populates
4. **Item model + manual creation** — Create note items, assign to boards
5. **Board detail view** — Grid/list of items in a board, basic card UI
6. **Inspector** — Show/edit item details, tags, board membership
7. **Quick capture** — Menu bar window, URL paste, metadata fetching
8. **Inbox + triage** — Inbox view, card stack, keep/later/drop flow
9. **Auto-tagging** — AI tagging on capture (start with API, add local model later)
10. **Tag clustering** — Auto-group items within boards by shared tags
11. **Annotations** — Inline annotation on articles, markdown support, `[[` linking
12. **Connections** — Manual connection creation, connection display in inspector
13. **Search** — Global fuzzy search across all entities
14. **Nudge system** — Basic resurface and stale inbox nudges
15. **Polish** — Keyboard shortcuts, animations, dark mode refinement, performance
